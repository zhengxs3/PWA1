<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#317EFB" />
    <title>PWAÂ DÃ©moÂ â€“Â Accueil</title>

    <!-- Manifest & icÃ´ne -->
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" href="icon.png" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <h1>PWAÂ DÃ©mo ðŸš€</h1>
      <button
        id="notify-btn"
        aria-label="Activer les notifications"
        title="Activer les notifications"
      >
        ðŸ””
      </button>
    </header>

    <main>
      <p>
        BienvenueÂ ! Cette page d'accueil est conÃ§ue pour dÃ©montrer les
        <strong>fonctionnalitÃ©s essentielles d'une Progressiveâ€¯Webâ€¯App</strong>.
      </p>
      <ul>
        <li>Fonctionne horsâ€‘ligne (grÃ¢ce au ServiceÂ Worker).</li>
        <li>Peut Ãªtre <em>installÃ©e</em> sur l'Ã©cran d'accueil.</li>
        <li>Affiche l'Ã©tat du rÃ©seau en direct.</li>
        <li>Permet de recevoir des notifications push.</li>
      </ul>
      <p id="network-info">
        Statut rÃ©seauÂ : <span id="status" class="offline">horsâ€‘ligne</span>
      </p>
    </main>

    <!-- BanniÃ¨re d'installation personnalisÃ©e -->
    <div id="install-banner">
      <span>Installer l'applicationÂ ?</span>
      <button id="install-btn">Installer</button>
    </div>

    <!-- Script d'enregistrement du ServiceÂ Worker & logiques PWA -->
    <script src="sw-register.js"></script>
    <script>
      // Indicateur rÃ©seau
      const statusEl = document.getElementById("status");
      function updateOnlineStatus() {
        const online = navigator.onLine;
        statusEl.textContent = online ? "enÂ ligne" : "horsâ€‘ligne";
        statusEl.className = online ? "online" : "offline";
      }
      window.addEventListener("online", updateOnlineStatus);
      window.addEventListener("offline", updateOnlineStatus);
      updateOnlineStatus();

      // Bouton cloche notifications
      const btn = document.getElementById("notify-btn");
      btn.addEventListener("click", async () => {
        if (!("Notification" in window)) {
          alert(
            "Les notifications ne sont pas prises en charge sur ce navigateur."
          );
          return;
        }

        let perm = Notification.permission;
        if (perm === "default") {
          perm = await Notification.requestPermission();
        }

        if (perm === "granted") {
          // TestÂ : affiche une notification locale (si serviceâ€‘worker dÃ©jÃ  actif)
          if (navigator.serviceWorker.controller) {
            navigator.serviceWorker.controller.postMessage({
              action: "test-notif",
            });
          } else {
            alert(
              "Service Worker non actif pour lâ€™instant. Recharge la page puis rÃ©essaie."
            );
          }
        } else {
          alert("Notifications refusÃ©esÂ ; impossible dâ€™activer.");
        }
      });
    </script>
  </body>
</html>
